<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
      	<link rel="shortcut icon" href="/resources/image/icon.png" />
		<link rel="apple-touch-icon" href="/resources/image/icon.png" />
		<!--[if lt IE 9]>
		<script src="/resources/js/html5shiv.js"></script>
		<![endif]-->
		<title>상세페이지</title>
		<script type="text/javascript" src="/resources/include/js/common.js"></script>
		<script type="text/javascript" src="/resources/include/js/jquery-1.12.4.min.js"></script>
		<script type="text/javascript">
		let buttonCheck = 0;
			$(function(){
				$("#pwdChk").css("visibility", "hidden");
				
				$("#insertBtn").click(function(){
					location.href="/board/writeForm";
				});
				
				$("#listBtn").click(function(){
					location.href="/board/boardList";
				});
				
				$("#updateBtn").click(function(){
					$("#pwdChk").css("visibility", "visible");
					$("#msg").text("작성시 입력한 비밀번호를 입력해주세요.").css("color", "#000099");
					buttonCheck=1;
				});
				
				$("#deleteBtn").click(function(){
					$("#pwdChk").css("visibility", "visible");
					$("#msg").text("작성시 입력한 비밀번호를 입력해주세요.").css("color", "#000099");
					buttonCheck=2;
				});
				$("#confirm").click(function(){
					boardPwdConfirm();
				});
			});
			
			function boardPwdConfirm(){
				if(!formCheck('#b_pwd', '#msg', "비밀번호를")) return;
				else{
					$.ajax({
						url:"/board/pwdConfirm",
						type:"post",
						data:$("#f_pwd").serialize(),
						dataType:"text",
						error:function(){
							alert('시스템 오류입니다. 관리자에게 문의하세요.');
						},
						success:function(resultData){
							var goUrl="";
							if(resultData=="실패"){
								$("#msg").text("작성시 입력한 비밀번호가 일치하지 않습니다.").css("color","red");
								$("#b_pwd").select();
							}else if(resultData=="성공"){
								$("#msg").text("");
								if(buttonCheck==1){
									goUrl="/board/updateForm";
									$("#f_data").attr("action", goUrl);
									$("#f_data").submit();
								}else if(buttonCheck==2){
									if(confirm("정말 삭제하시겠습니까?")){
										goUrl="/board/boardDelete",
										$("#f_data").attr("action", goUrl);
										$("#f_data").submit();
									}
								}
							}
						}
				});
					
				}
				
			}
		</script>
	</head>
	<body>
		<div class="container">
	
		<form name="f_data" id="f_data" method="post">
			<input type="hidden" name="b_num" value="${detail.b_num }" />
			<input type="hidden" name="b_file" value="${detail.b_file }" />
			<input type="hidden" name="b_thumb" value="${detail.b_thumb }" />
		</form>
		
		<div id="boardPwdBut" class="row text-center">
			<div id="pwdChk" class="text-left">
				<form name="f_pwd" id="f_pwd">
					<input type="hidden" name="b_num" id="b_num" value="${detail.b_num }" />
					<label for="b_pwd" id="l_pwd">비밀번호:</label>
					<input type="password" id="b_pwd" name="b_pwd" />
					
					<button type="button" id="confirm" class="btn btn-default">확인</button>
					<span id="msg"></span>
				</form>
			</div>
		<div class="text-right">
			<input type="button" id="updateBtn" value="수정"  class="btn btn-info" />
			<input type="button" id="deleteBtn" value="삭제" class="btn btn-info"/>
			<input type="button" id="insertBtn" value="글쓰기" class="btn btn-info"/>
			<input type="button" id="listBtn" value="목록" class="btn btn-info"/>
 		</div>
 	</div>
 	
		<form class="form-inline">
			<table class="table table-bordered">
				<tbody>
					<tr>
						<td class="text-center">글 번호</td>
						<td class="text-left">${detail.b_num}</td>
						<td class="text-center">작성일</td>
						<td class="text-left">${detail.b_date}</td>
					</tr>
					<tr>
						<td class="text-center">작성자</td>
						<td colspan="3" class="text-left">${detail.b_name}</td>
					</tr>
					<tr>
						<td class="text-center">글 제목</td>
						<td colspan="3" class="text-left">${detail.b_title}</td>
					</tr>
					<tr>
					<tr class="table-tr-height">
						<td class="text-center">글 내용</td>
						<td colspan="3" class="text-left">${detail.b_content}</td>
					</tr>
					<c:if test="${not empty detail.b_file}">
					<%-- 이미지가 존재하지 않으면 아예 이미지 칸을 보여주지 않기 위해 if문을 tr밖에 명시한다. --%>
					<tr>
						<td class="text-center">이미지</td>
						<td colspan="3" class="text-left col-md-8">
								<img src="/uploadStorage/board/${detail.b_file}" />
						</td>
					</tr>
					</c:if>
				</tbody>
			</table>
		</form>
			<jsp:include page="reply.jsp" />
		</div>
	</body>
</html>