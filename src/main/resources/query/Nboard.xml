<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.msix.client.nbaord.dao.NboardDAO">
	<!--<select id="nboardList" parameterType="nboard" resultType="nboard">
	 	SELECT n_no, n_title, n_content, to_char(n_date,'YYYY-MM-DD HH24:MI:SS') as n_date, n_cnt
    	FROM n_board
    	<where>
			<if test="search=='n_title'">
				<![CDATA[ n_title LIKE '%'|| #{keyword} ||'%' ]]>
			</if>
			<if test="search=='n_content'">
				<![CDATA[ n_content LIKE '%'|| #{keyword} ||'%' ]]>
			</if>			
		</where>
		ORDER BY n_no desc
	</select>--> 
	<!-- 게시판 리스트 조회(페이징 처리와 검색 처리) 및 댓글 갯수 구하기-->
	<sql id="nboardSearch">
		<if test="search=='n_title'">
				<![CDATA[ n_title LIKE '%'|| #{keyword} ||'%' ]]>
		</if>
		<if test="search=='n_content'">
				<![CDATA[ n_content LIKE '%'|| #{keyword} ||'%' ]]>
		</if>	
	</sql>
	
	<select id="nboardList" parameterType="nboard" resultType="nboard">
		<![CDATA[
		SELECT n_no, n_title, to_char(n_date,'YYYY-MM-DD') as n_date,n_cnt
		FROM (
			SELECT /*+ INDEX_DESC(n_board n_board_pk) */
					rownum as rnum, n_no, n_title, n_date,n_cnt
			FROM n_board
			WHERE]]>
			<trim prefix="(" suffix=") AND " prefixOverrides="AND">
				<include refid="nboardSearch"></include>
			</trim>
	<![CDATA[	rownum <= #{pageNum} * #{amount}
			) nboardlist
		WHERE rnum > (#{pageNum}-1) * #{amount}
	]]>
	</select>
	
	<!-- 전체 레코드수 조회 -->
	<select id="nboardListCnt" parameterType="nboard" resultType="int">
		select count(*) From n_board
		<trim prefix="where">  </trim>
	</select>
		<!-- 상세 페이지를 위한 게시물 조회--> 
	<select id="nboardDetail" parameterType="nboard" resultType="nboard">
		SELECT 
				n_no, n_title, n_content, 
				TO_CHAR(n_date,'YYYY-MM-DD HH24:MI:SS') as n_date, n_cnt
		FROM n_board
		WHERE n_no = #{n_no}
	</select>
	<update id="cntUpdate" parameterType="nboard" >
		update n_board set n_cnt =n_cnt +1
		where n_no=#{n_no}
	</update>
	
</mapper>